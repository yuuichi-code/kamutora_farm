<%= form_with model: post_form_step, url: create_step, local: true do |f| %>
  <%= render 'shared/error_messages', object: f.object %>
  <div class="mt-6 flex justify-center">
    <table>
      <thead>
        <tr class="border border-black">
          <%# 空欄のマスが必要なため空のthを追加 %>
          <th colspan="2"></th>
          <% @turns.each do |turn| %>
            <th class="border border-black">
              <%= turn.add_to_turn_number(@now_chapter.chapter_number).to_s + t('defaults.day') %>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody class="border border-black">
        <tr>
          <td colspan="2" class="border border-black"></td>
          <%# 行動選択用 %>
          <% days = [:first_day_action, :second_day_action, :third_day_action, :fourth_day_action, :fifth_day_action, :sixth_day_action, :seventh_day_action, :eighth_day_action] %>
          <% days.each do |day| %>
            <td class="border border-black">
              <div>
                <%= f.collection_select "#{day}", @actions, :id, :content, { prompt: t('defaults.action_choice') } %>
              </div>
              <div data-controller="remarks">
                <button data-action="click->remarks#remarks_btn" data-target="remarks.remarks" data-field-name="<%= "#{day.to_s.gsub('_action', '_remark')}" %>" data-now-step="<%= step_number %>" type="button">
                  <%= t('defaults.add_remark') %>
                </button>
              </div>
            </td>
          <% end %>
        </tr>
        <% @farm_places.each do |farm_place| %>
          <% case farm_place.farm_number %>
            <%# 1の畑の場合 %>
            <% when @farm_places.first.farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td rowspan="18" class="border border-black"><%= FarmPlace.model_name.human %></td>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm1_seeds = [:day1_farm1_seed, :day2_farm1_seed, :day3_farm1_seed, :day4_farm1_seed, :day5_farm1_seed, :day6_farm1_seed, :day7_farm1_seed, :day8_farm1_seed] %>
                <% farm1_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm1_characters = [:day1_farm1_character, :day2_farm1_character, :day3_farm1_character, :day4_farm1_character, :day5_farm1_character, :day6_farm1_character, :day7_farm1_character, :day8_farm1_character] %>
                <% farm1_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 2の畑の場合 %>
            <% when @farm_places.second.farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm2_seeds = [:day1_farm2_seed, :day2_farm2_seed, :day3_farm2_seed, :day4_farm2_seed, :day5_farm2_seed, :day6_farm2_seed, :day7_farm2_seed, :day8_farm2_seed] %>
                <% farm2_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm2_characters = [:day1_farm2_character, :day2_farm2_character, :day3_farm2_character, :day4_farm2_character, :day5_farm2_character, :day6_farm2_character, :day7_farm2_character, :day8_farm2_character] %>
                <% farm2_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 3の畑の場合 %>
            <% when @farm_places.third.farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm3_seeds = [:day1_farm3_seed, :day2_farm3_seed, :day3_farm3_seed, :day4_farm3_seed, :day5_farm3_seed, :day6_farm3_seed, :day7_farm3_seed, :day8_farm3_seed] %>
                <% farm3_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm3_characters = [:day1_farm3_character, :day2_farm3_character, :day3_farm3_character, :day4_farm3_character, :day5_farm3_character, :day6_farm3_character, :day7_farm3_character, :day8_farm3_character] %>
                <% farm3_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 4の畑の場合 %>
            <% when @farm_places.fourth.farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm4_seeds = [:day1_farm4_seed, :day2_farm4_seed, :day3_farm4_seed, :day4_farm4_seed, :day5_farm4_seed, :day6_farm4_seed, :day7_farm4_seed, :day8_farm4_seed] %>
                <% farm4_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm4_characters = [:day1_farm4_character, :day2_farm4_character, :day3_farm4_character, :day4_farm4_character, :day5_farm4_character, :day6_farm4_character, :day7_farm4_character, :day8_farm4_character] %>
                <% farm4_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 5の畑の場合 %>
            <% when @farm_places.fifth.farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm5_seeds = [:day1_farm5_seed, :day2_farm5_seed, :day3_farm5_seed, :day4_farm5_seed, :day5_farm5_seed, :day6_farm5_seed, :day7_farm5_seed, :day8_farm5_seed] %>
                <% farm5_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm5_characters = [:day1_farm5_character, :day2_farm5_character, :day3_farm5_character, :day4_farm5_character, :day5_farm5_character, :day6_farm5_character, :day7_farm5_character, :day8_farm5_character] %>
                <% farm5_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 6の畑の場合 %>
            <% when @farm_places[5].farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm6_seeds = [:day1_farm6_seed, :day2_farm6_seed, :day3_farm6_seed, :day4_farm6_seed, :day5_farm6_seed, :day6_farm6_seed, :day7_farm6_seed, :day8_farm6_seed] %>
                <% farm6_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm6_characters = [:day1_farm6_character, :day2_farm6_character, :day3_farm6_character, :day4_farm6_character, :day5_farm6_character, :day6_farm6_character, :day7_farm6_character, :day8_farm6_character] %>
                <% farm6_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 7の畑の場合 %>
            <% when @farm_places[6].farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm7_seeds = [:day1_farm7_seed, :day2_farm7_seed, :day3_farm7_seed, :day4_farm7_seed, :day5_farm7_seed, :day6_farm7_seed, :day7_farm7_seed, :day8_farm7_seed] %>
                <% farm7_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm7_characters = [:day1_farm7_character, :day2_farm7_character, :day3_farm7_character, :day4_farm7_character, :day5_farm7_character, :day6_farm7_character, :day7_farm7_character, :day8_farm7_character] %>
                <% farm7_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 8の畑の場合 %>
            <% when @farm_places[7].farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm8_seeds = [:day1_farm8_seed, :day2_farm8_seed, :day3_farm8_seed, :day4_farm8_seed, :day5_farm8_seed, :day6_farm8_seed, :day7_farm8_seed, :day8_farm8_seed] %>
                <% farm8_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm8_characters = [:day1_farm8_character, :day2_farm8_character, :day3_farm8_character, :day4_farm8_character, :day5_farm8_character, :day6_farm8_character, :day7_farm8_character, :day8_farm8_character] %>
                <% farm8_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
            <%# 9の畑の場合 %>
            <% when @farm_places[8].farm_number then %>
              <%# 種設置用 %>
              <tr>
                <td class="border border-black"><%= farm_place.farm_number.to_s + t('defaults.of_farm') %></td>
                <% farm9_seeds = [:day1_farm9_seed, :day2_farm9_seed, :day3_farm9_seed, :day4_farm9_seed, :day5_farm9_seed, :day6_farm9_seed, :day7_farm9_seed, :day8_farm9_seed] %>
                <% farm9_seeds.each do |seed| %>
                  <td class="border border-black">
                    <%= f.collection_select seed, @flower_seeds, :id, :name, { prompt: t('defaults.seed_choice') } %>
                  </td>
                <% end %>
              </tr>
              <%# キャラクター設置用 %>
              <tr>
                <td class="border border-black"><%= t('defaults.set_character') %></td>
                <% farm9_characters = [:day1_farm9_character, :day2_farm9_character, :day3_farm9_character, :day4_farm9_character, :day5_farm9_character, :day6_farm9_character, :day7_farm9_character, :day8_farm9_character] %>
                <% farm9_characters.each do |character| %>
                  <td class="border border-black">
                    <%= f.collection_select character, @selected_support_characters, :id, :name, { prompt: t('defaults.character_choice') } %>
                  </td>
                <% end %>
              </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="flex justify-between mt-8 mr-32 mb-8 ml-32">
    <%= link_to (t 'defaults.return_step'), return_step, class: 'rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-center text-sm font-medium text-gray-700 shadow-sm transition-all hover:bg-gray-100 focus:ring focus:ring-gray-100 disabled:cursor-not-allowed disabled:border-gray-100 disabled:bg-gray-50 disabled:text-gray-400' %>
    <%= f.submit (t 'defaults.next_step'), class: 'rounded-lg border border-gray-300 bg-white px-5 py-2.5 text-center text-sm font-medium text-gray-700 shadow-sm transition-all hover:bg-gray-100 focus:ring focus:ring-gray-100 disabled:cursor-not-allowed disabled:border-gray-100 disabled:bg-gray-50 disabled:text-gray-400' %>
  </div>
<% end %>